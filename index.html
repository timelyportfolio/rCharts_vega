<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>rCharts with from.js</title>

    <link rel="stylesheet" href="./css/bootstrap.min.css">

    <script src="./js/ace.js"></script>
    <script src="./js/lazy.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div id = "editor-data" class ="col-md-4 editor" style="height:250px;">
        </div><!--col-md-->
        <div id = "editor-lazyjs" class ="col-md-4 editor" style="height: 250px;">
        </div><!--col-md-->
        <div id = "editor-result" class ="col-md-4 editor" style="height: 250px;">
        </div><!--col-md-->
      </div><!--row-->
      <div class="row">
      
      </div><!--row-->
    </div><!--container-->

    <script>
      var editor_data = ace.edit("editor-data");
      editor_data.setTheme("ace/theme/twilight");
      editor_data.getSession().setMode("ace/mode/json");

      var editor_lazyjs = ace.edit("editor-lazyjs");
      editor_lazyjs.setTheme("ace/theme/twilight");
      editor_lazyjs.getSession().setMode("ace/mode/javascript");

      var editor_result = ace.edit("editor-result");
      editor_result.setTheme("ace/theme/twilight");
      editor_result.getSession().setMode("ace/mode/json");
      editor_result.setReadOnly(true);

      //quick example of a moving average with Lazyjs consecutive
      var spdata = [
       {
         "date": "1957-01-31",
         "sp500": 44.72
       },
      {
        "date": "1957-02-28",
        "sp500": 43.26
      },
      {
        "date": "1957-03-29",
        "sp500": 44.11
      },
      {
        "date": "1957-04-30",
        "sp500": 45.74
      },
      {
        "date": "1957-05-31",
        "sp500": 47.43
      },
      {
        "date": "1957-06-28",
        "sp500": 47.37
      },
      {
        "date": "1957-07-31",
        "sp500": 47.91
      },
      {
        "date": "1957-08-30",
        "sp500": 45.22
      },
      {
        "date": "1957-09-30",
        "sp500": 42.42
      },
      {
        "date": "1957-10-31",
        "sp500": 41.06
      },
      {
        "date": "1957-11-29",
        "sp500": 41.72
      },
      {
        "date": "1957-12-31",
        "sp500": 39.99
      },
      {
        "date": "1958-01-31",
        "sp500": 41.7
      },
      {
        "date": "1958-02-28",
        "sp500": 40.84
      },
      {
        "date": "1958-03-31",
        "sp500": 42.1
      },
      {
        "date": "1958-04-30",
        "sp500": 43.44
      },
      {
        "date": "1958-05-29",
        "sp500": 44.09
      },
      {
        "date": "1958-06-30",
        "sp500": 45.24
      },
      {
        "date": "1958-07-31",
        "sp500": 47.19
      },
      {
        "date": "1958-08-29",
        "sp500": 47.75
      },
      {
        "date": "1958-09-30",
        "sp500": 50.06
      },
      {
        "date": "1958-10-31",
        "sp500": 51.33
      },
      {
        "date": "1958-11-28",
        "sp500": 52.48
      },
      {
        "date": "1958-12-31",
        "sp500": 55.21
      },
      {
        "date": "1959-01-30",
        "sp500": 55.42
      },
      {
        "date": "1959-02-27",
        "sp500": 55.41
      },
      {
        "date": "1959-03-31",
        "sp500": 55.44
      },
      {
        "date": "1959-04-30",
        "sp500": 57.59
      },
      {
        "date": "1959-05-29",
        "sp500": 58.68
      },
      {
        "date": "1959-06-30",
        "sp500": 58.47
      },
      {
        "date": "1959-07-31",
        "sp500": 60.51
      },
      {
        "date": "1959-08-31",
        "sp500": 59.6
      },
      {
        "date": "1959-09-30",
        "sp500": 56.88
      },
      {
        "date": "1959-10-30",
        "sp500": 57.52
      }]

      var ma = Lazy(spdata)
              .consecutive(10)  //10 day mov avg
              .map(function (d) {
                //sum divided by length gives simple moving average
                madata = {
                  "date": Lazy(d).pluck("date").last(),
                  "movavg": Lazy(d).sum(function (d) { return d.sp500 }) / Lazy(d).length()
                };
                return madata;
              });
      console.log(ma.take(3).toArray());
    </script>
  </body>
</html>
